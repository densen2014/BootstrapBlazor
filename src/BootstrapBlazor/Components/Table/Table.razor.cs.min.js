(function(n){n.extend({bb_table_search:function(t,i,r,u){n(t).data("bb_table_search",{obj:i,searchMethod:r,clearSearchMethod:u})},bb_table_resize:function(t){var u=t.find(".col-resizer");if(u.length>0){var f=function(t){var u=n(this),i=u.closest("th");t?i.addClass("border-resize"):i.removeClass("border-resize");var r=i.index(),f=i.closest(".table-resize").find("tbody"),e=f.find("tr").each(function(){var i=n(this.children[r]);t?i.addClass("border-resize"):i.removeClass("border-resize")});return r},i=0,e=0,r=0,o=0;u.each(function(){n(this).drag(function(u){r=f.call(this,!0);var s=t.find("table colgroup col")[r].width;i=s?parseInt(s):n(this).closest("th").width();e=n(this).closest("table").width();o=u.clientX},function(u){t.find("table colgroup").each(function(t,f){var h=n(f).find("col")[r],s=u.clientX-o;h.width=i+s;t===0&&n(f).closest("table").width(e+s)})},function(){f.call(this,!1)})})}},bb_table_load:function(t,i){var u=n(t),r=u.find(".table-loader");i==="show"?r.addClass("show"):r.removeClass("show")},bb_table:function(t,i,r){var u=n(t),y=function(){u.find(".is-tips").tooltip({container:"body",title:function(){return n(this).text()}})},p,h,s,f,e,c,o,l,a,v,w;if(i==="fixTableHeader"){p=u.find(".table-fixed-header");h=u.find(".table-fixed-body");h.on("scroll",function(){var n=h.scrollLeft();p.scrollLeft(n)});if(s=u.find(".fixed-scroll"),s.length===1){for(f=s.prev();f.length===1;)if(f.hasClass("fixed-right")&&!f.hasClass("modified"))e=f.css("right"),e=e.replace("px",""),n.browser.versions.mac?e=parseFloat(e)-2+"px":n.browser.versions.mobile&&(e=parseFloat(e)-17+"px"),f.css({right:e}).addClass("modified"),f=f.prev();else break;n.browser.versions.mobile&&s.remove()}u.find(".col-resizer:last").remove();n.bb_table_resize(u)}else if(i==="init"){c=u.find(".table-cell.is-sort .table-text");o={unset:"点击升序",sortAsc:"点击降序",sortDesc:"取消排序"};c.each(function(){var i=n(this).parent().find(".fa:last"),t;i.length>0&&(t=o.unset,i.hasClass("fa-sort-asc")?t=o.sortAsc:i.hasClass("fa-sort-desc")&&(t=o.sortDesc),n(this).tooltip({container:"body",title:t}))});c.on("click",function(){var i=n(this),u=i.parent().find(".fa:last"),t="sortAsc",r,f;u.hasClass("fa-sort-asc")?t="sortDesc":u.hasClass("fa-sort-desc")&&(t="unset");r=n("#"+i.attr("aria-describedby"));r.length>0&&(f=r.find(".tooltip-inner"),f.html(o[t]),i.attr("data-original-title",o[t]))});l=u.find(".table-toolbar");a=0;l.length>0&&(a=l.height());v=function(){var s=n(this).position(),h=n(this).attr("data-field"),r=u.find('.table-filter-item[data-field="'+h+'"]'),t=n(this).closest("th"),e=t.outerWidth()+t.position().left-r.outerWidth()/2,i=0,o,f;t.hasClass("sortable")&&(i=24);t.hasClass("filterable")&&(i=i+12);o=t.closest("table").parent().scrollLeft();f=t.offset().left+t.outerWidth()-i+r.outerWidth()/2-n(window).width();i=i+o;f>0&&(e=e-f-16,$arrow=r.find(".card-arrow"),$arrow.css({left:"calc(50% - 0.5rem + "+(f+16)+"px)"}));r.css({top:s.top+a+50,left:e-i})};u.find(".filterable .fa-filter").on("click",function(){v.call(this)});y();u.children(".table-scroll").scroll(function(){u.find(".table-filter-item.show").each(function(){var t=n(this).attr("data-field"),i=u.find('.fa-filter[data-field="'+t+'"]')[0];v.call(i)})});n.bb_table_resize(u)}else{if(i==="width")return w=0,r?u.outerWidth(!0):n(window).outerWidth(!0);i==="tooltip"&&y()}}});n(function(){n(document).on("keyup",function(t){var r,i;t.key==="Enter"?(r=n(t.target).closest(".table-container"),i=r.data("bb_table_search"),i&&i.obj.invokeMethodAsync(i.searchMethod)):t.key==="Escape"&&(r=n(t.target).closest(".table-container"),i=r.data("bb_table_search"),i&&i.obj.invokeMethodAsync(i.clearSearchMethod))})})})(jQuery);